---
title: "Kesifci Veri Analiz"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

# Iste Veri Onumde Simdi Ne Yapacagim?

Iste veri onumde simdi ne yapacagim?

https://www.veribilimiokulu.com/iste-veri-onumde-simdi-ne-yapacagim/

1. Amac Ne?
2. Tidy Data Sureci
3. Degisken Turlerinin Belirlenmesi ve Ayarlanmasi
4. Ozet Istatistikler: Veri Setinin Temel Yapisinin Gosterilmesi
5. Kesifci Veri Analizi

```{r}

library(tidyverse)

```

## Degisken Turlerinin Ayarlanmasi

Burada mpg veri setini ele alalım. mpg veri setindeki "class" degiskeninin türünün "character" olarak girildigini görüyoruz. Bu class degiskeni aslında bir aracin kac kapı oldugunu bize söylüyor. Yani aracın fiyatı odak noktası oldugunda ayırt edici bir özellik. Dolayısıyla bu değişkenin "kategorik" bir değişken olması gerekiyor.

```{r}

df <- mpg

# class degiskenini characterden factor'e cevirelim
df$class <- factor(df$class)

glimpse(df) # bakalim gercekten factor oldu mu?

# sürekli bir degiskeni kategorik degiskene dönüstürmek istiyorum

# displ degiskeninde eger surekli degiskenin degeri 2den buyuk ise 1 degilse 0 yap
df$disp_yeni <- ifelse(df$displ > 2, 1, 0)

# degiskeni kategorik yaptik fakat tipi double. Düzenleyelim
df$disp_yeni <- factor(df$disp_yeni)

# cut fonksiyonu 
#             : 1. arguman: üzerinde degisiklik yapmak istedigim degisken
#           : 2. arguman : yapılacak olan donusumdeki sınırlar
              
df$disp_iki <- cut(df$displ, breaks = c(0,2, max(df$displ)))
```

## Veriye İlk Bakıs

```{r}
install.packages("psych")
library(psych)
```


```{r}
colnames(mpg) # veri setindeki degiskenlerin isimlerini verir
rownames(mpg) # gözlemleri verir

nrow(mpg) # satir sayisi
ncol(mpg) # sutun sayisi

head(mpg) # ilk 6 gozlemi gösterir

str(mpg) # veri seti hakkında bilgi verir
glimpse(mpg) # str ile aynı işlevi görür

psych::headTail(mpg) # bastaki ve sondaki gozlemler ile ilgili bilgi verir

summary(df) # özet istatistikleri verir

fivenum(df$displ) # istedigimiz degiskenin ortalama haric diger 5 istatistik bilgisini verir

levels(df$class) # kategorik degiskenin kategorilerini verir

```


## Surekli ve Kategorik Degiskenler Icın Direkt Detaylar

```{r}
install.packages("funModeling")
library(funModeling)

```


```{r}

# SUREKLI DEGISKENLER ICIN

profiling_num(df) #özet istatistikleri verir
plot_num(df) # her degiskene ait histogram grafigi çizer

# KATEGORIK DEGISKENLER ICIN

freq(df) # özet istatistikleri + grafik verir
```

## Surekli ve Kategorik Degisken Detaylari

```{r}
library(psych)
library(Hmisc)
library(dplyr)
install.packages("pastecs")
library(pastecs)
```


```{r}
# SUREKLI DEGISKENLER ICIN

# describe() fonksiyonu ile betimleyici istatistiklere erisiriz.

# Hmisc kütüphanesindeki describe() fonksiyonu eksik gozlemleri, özgün gözlemleri, en kücük ve en büyük gözlemleri de bize sunar.

# pastecs kütüphanesindeki stat.desc() fonksiyonu bize güven aralıgını da verir.

psych::describe(mpg$displ)
Hmisc::describe(mpg$displ)

stat.desc(mpg)

# KATEGORİK DEGISKEN ICIN

# describe.by() fonksiyonu verilen bir kategorik degisken kırılımında veri setini özetler.

# bu fonksiyonu uygulamak icin ilk olarak bir kategorik degisken secelim. (trans) Bu kategorik degiskene iliskin sürekli degiskenler secelim.

df <- select(mpg, trans, cty, cyl, hwy)

describe.by(df, df$trans)

# trans degiskeninin butun sınıfları için bir kırılım olusturmus oldu. Bu sayede trans kategorik degiskeninin her sınıfı icin surekli degiskenlerin degerlerinin degiskenlik gösterdigini görebiliriz. Cünkü Ortalama ve medyan değerleri birbirinden farkli


```


## Data Frame'lerin Interaktif Kesfi

Karmasik veriler icin kullanılabilecek görseller

```{r}
install.packages("d3Tree")
library(d3Tree)
```
```{r}

# d3tree fonksiyonu, hiyerarşik veri yapılarını görselleştirmek için kullanılır. Bu tür görselleştirmeler, veri kümelerinin hiyerarşik ilişkilerini ve yapısını anlamak için oldukça etkilidir.

# rootname : veri setinin ismi
# struct : yapısı cıkacak veri seti
# layout : tema

d3tree(list(root = df2tree(rootname = "Titanic",
                           struct = as.data.frame(Titanic)),
            layout = "collapse"))
```

```{r}
install.packages("devtools")
library(devtools)
install.packages("haven")
library(haven)
devtools::install_github("rsquaredacademy/xplorerr")
library(xplorerr)

```

```{r}
app_descriptive()
```

## Dagilim - Bar Plot ( Sutun Grafik )

Kategorik degiskenlerin frekanslarını gözlemlemek icin kullanılır.

```{r}

# Kategorik degiskenlerimizi görsellestirmek icin kullandıgımız veri setimiz diamond
df <- diamonds

# Degisken türlerini incelemek icin glimpse() fonksiyonunu kullandık.
glimpse(df)

# Bar Plot

# ggplot(veriSeti, aes(ilgilendigimiz degisken)) + geom_bar() 
# Kategorik degiskenin sınıflarının gözlenme sayilarini verir.

ggplot(df, aes(cut)) +
  geom_bar()

# fill = color  ile cut degiskeninin icindeki sınıflarda color degiskeninin sınıflarından kacar tane var görebiliyoruz.

ggplot(df, aes(cut, fill = color)) +
  geom_bar()

# position = position_dodge() ile 2 kategorik degiskenin grafiklerini birbirinden ayırarak daha okunaklı bir görsel hazırlanır. 

ggplot(df, aes(cut, fill = color)) +
  geom_bar(position = position_dodge()) +
  ggtitle("Bu yazı ana baslık yazısıdır") +
  xlab("Pırlanta Kaliteleri") +
  ylab("Gözlenme Sıklıkları")

```

## Dagılım - Histogram ve Yogunluk 

## Histogram

Bir sürekli degiskeni görsellestirmek istedigimizde en sık kullanılan görsellestirme tekniklerinden birisidir.

```{r}

glimpse(df)

# price degiskenini görsellestirelim

ggplot(df, aes(price)) + 
  geom_histogram()
  
# binwidth = 1000 ile histogramın aralıkları genişletebiliriz

ggplot(df, aes(price)) + 
  geom_histogram(binwidth = 1000)
```

## Yoğunluk

```{r}

glimpse(df)

# price degiskenini görsellestirelim

ggplot(df, aes(price)) + 
  geom_density()

```

## Yogunluk ve Histogram Grafiği

ggplot kullanırken birden fazla geometrik nesneyi birlikte kullanmak için bunların ölçeklerinin aynı olması gerekir. Bunun için aes(y = after_stat(density)) yazmak yeterlidir.

```{r}

ggplot(df, aes(price)) +
  geom_histogram(aes(y = after_stat(density))) +
  geom_density()

# saydamlık ekleyelim. yogunluk grafigini turuncu yapalim

ggplot(df, aes(price)) +
  geom_histogram(aes(y = after_stat(density))) +
  geom_density(alpha = .3, fill = "orange")

```

# Yukarıdaki kod mantıgında fakat görsel açıdan daha profesyonel hali

```{r}
library(ggplot2)

# diamonds veri setini kullanarak grafiği oluşturma
ggplot(diamonds, aes(x = price)) +
  geom_histogram(aes(y = after_stat(density)), bins = 30, fill = "blue", color = "black", alpha = 0.6) +
  geom_density(alpha = 0.3, fill = "orange") +
  labs(
    title = "Distribution of Diamond Prices with Density Overlay",
    x = "Price (USD)",
    y = "Density"
  ) +
  scale_y_continuous(labels = scales::number_format(accuracy = 0.0001)) + # Yoğunluk eksenini daha anlamlı hale getir
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10),
    legend.position = "none"
  )

```

Bir kategorik bir de sürekli bir değişkenimin oldugunu varsayalım. Amaç sürekli değişken kırılımında histogramları göstermek olsun.

```{r}

ggplot(df, aes(price, fill = cut)) +
  geom_histogram() 

# Bu kırılımların üst üste olması dağınık bir görünüm sunuyor. facet_grid ile tüm kategorileri düzgün bir şekilde ayırabiliriz.

ggplot(df, aes(price)) +
  geom_histogram() +
  facet_grid((cut ~.))

```

# Görsel Acidan daha profesyonel bir kod

```{r}
library(ggplot2)
library(datasets)

# diamonds veri setini kullanarak grafiği oluşturma
ggplot(diamonds, aes(x = price, fill = cut)) +
  geom_histogram(binwidth = 500, alpha = 0.7, position = "identity") +
  facet_grid(cut ~ .) +
  labs(
    title = "Diamond Prices by Cut",
    x = "Price (USD)",
    y = "Count",
    fill = "Cut"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10),
    strip.text = element_text(size = 12, face = "bold"),
    legend.position = "none"
  ) +
  scale_fill_brewer(palette = "Set3")

```


Kaynaklar: r for data science, r-graph-gallery.com, modern r programlama egitimi